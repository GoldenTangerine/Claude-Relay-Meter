# 更新日志

所有关于此项目的重要更改都将记录在此文件中。

## [1.0.5] - 2025-10-15

### ✨ 新增
- **悬浮窗总费用显示**
  - 在状态栏悬浮窗的"其他统计"部分添加"总费用"字段
  - 显示累计总花费，数据来源：API 响应的 `formattedCost` 字段
  - 示例：**总费用：** $160.35
  - 支持中英文界面

### 📚 文档改进
- **API 响应格式文档**
  - 在 `CLAUDE.md` 中添加完整的 API 响应示例
  - 包含 `/api/user-stats` 端点的详细数据结构说明
  - 添加关键字段说明，便于后续开发和调试

### 🛠️ 技术改进
- 更新 `src/handlers/statusBar.ts` 中的 `createTooltip()` 函数
- 在中英文语言包中添加 `tooltips.totalCost` 翻译
- 直接使用 API 返回的格式化字段，避免重复处理

---

## [1.0.4] - 2025-10-14

### 🎨 改进
- **大数字显示优化**
  - 优化总请求数和总 Token 数的显示格式
  - 自动转换为易读单位：K（千）、M（百万）、B（十亿）
  - 示例：
    - `4,042` → `4K`
    - `171,659,455` → `171.7M`
    - `1,500,000,000` → `1.5B`
  - 智能小数位保留：数值 < 10 保留2位，≥ 10 保留1位
  - 自动去除末尾零，保持简洁

### 🛠️ 技术改进
- 新增 `formatLargeNumber()` 函数在 `src/utils/formatter.ts`
- 更新状态栏悬浮窗中的"其他统计"显示逻辑
- 改进数字可读性，提升用户体验

---

## [1.0.3] - 2025-10-11

### ✨ 新增
- **网页仪表板快捷入口**
  - 在状态栏悬浮窗中添加"网页仪表板"按钮
  - 点击按钮可直接在浏览器中打开中继服务的 API 统计网页
  - 自动构建 URL：`${apiUrl}/admin-next/api-stats?apiId=${apiId}`
  - 支持中英文界面

### 🎨 改进
- **优化悬浮窗布局**
  - 将操作按钮区域从单行改为两行显示
  - 第一行：💡 提示文本
  - 第二行：操作按钮（打开设置 | 网页仪表板）
  - 避免内容拥挤，提升可读性

### 🛠️ 技术改进
- 新增命令：`claude-relay-meter.openWebDashboard`
- 使用 `vscode.env.openExternal()` 打开外部链接
- 更新 `updateStatusBar()` 和 `createTooltip()` 函数签名
- 简化国际化文本："打开网页仪表板" → "网页仪表板"

### 👥 贡献者
- Co-authored-by: GoldenTangerine

---

## [1.0.2] - 2025-10-11

### 🌐 新增
- ✨ **完整的国际化支持 (i18n)**
  - 支持中文和英文界面
  - 新增语言选择命令：`Select Language / 选择语言`
  - 新增配置项：`relayMeter.language`
  - 所有用户可见文本支持多语言
  - 实时语言切换，无需重启

### 🛠️ 技术改进
- 实现完整的 i18n 系统（参照 cursor-stats 设计）
- 新增 `src/interfaces/i18n.ts` - 语言包类型定义
- 新增 `src/utils/i18n.ts` - 国际化工具
- 新增 `src/locales/zh.json` 和 `en.json` - 语言包
- 翻译函数 `t()` 支持嵌套键和参数替换
- 自动回退到中文（如果翻译缺失）

### 🐛 修复
- 修复扩展加载失败问题（asynckit 模块找不到）
- 修复输出通道不显示在下拉列表的问题
- 修复未配置时状态栏不显示的问题
- 优化依赖打包策略，确保所有嵌套依赖被正确包含

### 📦 构建优化
- 编译脚本自动复制语言包文件到 `out/locales/`
- 新增 `npm run copy-locales` 命令
- 移除 `.vscodeignore` 中的 node_modules 白名单限制

### 📝 文档更新
- 更新 `CLAUDE.md` - 添加国际化章节
- 新增 `UPDATE_NOTES_v1.0.2.md` - 详细更新说明
- 更新文件组织结构文档
- 添加如何添加新语言的指南

---

## [1.0.0] - 2025-10-11

### 新增功能
- ✅ 实现基本的用量监控功能
- ✅ 支持从 Claude Relay Service API 获取用量数据
- ✅ 在 VSCode 状态栏实时显示费用使用情况
- ✅ 支持智能颜色提示（绿/黄/红）
- ✅ 鼠标悬停显示详细的费用信息
  - 每日费用限制及使用情况
  - 总费用限制及使用情况
  - Opus 模型周费用限制及使用情况
- ✅ 支持自动定时刷新（默认 60 秒，可配置）
- ✅ 支持手动刷新统计数据
- ✅ 支持自定义 API URL 和 API ID
- ✅ 支持自定义刷新间隔
- ✅ 支持自定义颜色阈值和颜色
- ✅ 完善的错误处理和提示
- ✅ 详细的日志记录功能

### 技术特性
- ✅ 使用 TypeScript 开发，提供完整的类型安全
- ✅ 模块化的代码结构，易于维护和扩展
- ✅ 支持 API 请求重试机制（指数退避）
- ✅ 智能的窗口焦点检测
- ✅ 配置变更自动更新
- ✅ 完整的中文注释和文档

### 已知限制
- 仅支持单个 API 账户监控
- 数据刷新频率最小为 10 秒

### 计划功能
- [ ] 支持多账户监控
- [ ] 添加使用趋势图表
- [ ] 支持导出使用报告
- [ ] 添加使用警报通知
- [ ] 支持更多自定义配置选项

---

## 格式说明

- **新增功能** - 新添加的功能
- **改进** - 对现有功能的改进
- **修复** - Bug 修复
- **移除** - 移除的功能
- **安全** - 安全相关的更新
